<script>
    // Close the popup form
    function closeForm() {
        document.getElementById('popupForm').style.display = 'none';
        document.getElementById('overlay').style.display = 'none';
    }

    // Telegram WebApp API to auto-fill user data
    window.onload = function () {
        if (window.Telegram && Telegram.WebApp) {
            Telegram.WebApp.ready();
            const user = Telegram.WebApp.initDataUnsafe.user;

            if (user) {
                document.getElementById("telegram_name").value = user.first_name + " " + (user.last_name || "");
                document.getElementById("telegram_username").value = user.username ? "@" + user.username : "N/A";
                document.getElementById("telegram_id").value = user.id;

                console.log("User Data Retrieved:", user); // Debugging - Check if user data is retrieved correctly
            } else {
                console.error("❌ No user data retrieved from Telegram WebApp.");
            }
        } else {
            console.error("❌ Telegram WebApp is not available.");
        }
    };

    // Handle form submission
    document.getElementById('detailsForm').addEventListener('submit', function(event) {
        event.preventDefault();

        // Collect form data
        const formData = {
            telegram_name: document.getElementById('telegram_name').value,
            telegram_username: document.getElementById('telegram_username').value,
            telegram_id: document.getElementById('telegram_id').value,
            date: document.getElementById('date').value,
            number: document.getElementById('number').value
        };

        console.log("Collected Form Data:", formData); // Debugging - Check if form data is correct before sending

        // Send data to Telegram bot
        sendToTelegram(formData);
        closeForm();
    });

    // Function to send data to Telegram
    function sendToTelegram(formData) {
        const botToken = '7100869336:AAGcqGRUKa1Q__gLmDVWJCM4aZQcD-1K_eg';
        const chatId = '8101143576';
        const url = `https://api.telegram.org/bot${botToken}/sendMessage`;

        const message = `📩 New Form Submission:
💠 Name: ${formData.telegram_name || "N/A"}
🆔 ID: ${formData.telegram_id || "N/A"}
🔷 Username: ${formData.telegram_username || "N/A"}
📅 Date: ${formData.date}
📞 Number: ${formData.number}`;

        console.log("Sending Message:", message); // Debugging - Check if the message is correct before sending

        fetch(url, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ chat_id: chatId, text: message })
        })
        .then(response => response.json())
        .then(result => console.log('✅ Message sent to Telegram:', result))
        .catch(error => console.error('❌ Error sending message to Telegram:', error));
    }
</script>
